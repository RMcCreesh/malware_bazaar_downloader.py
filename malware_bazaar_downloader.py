import os
import requests

# Prompt user for the tag and download limit
TAG = input("Enter the Malware Bazaar tag: ")
DOWNLOAD_LIMIT = int(input("Enter the download limit: "))

# Download hash values from tag, save the SHA256 hashes
response = requests.post(
    "https://mb-api.abuse.ch/api/v1/",
    data={"query": "get_taginfo", "tag": TAG, "limit": DOWNLOAD_LIMIT}
)
hashes = [entry["sha256_hash"] for entry in response.json()["data"]]
with open(f"{TAG}.hash", "w") as f:
    f.write("\n".join(hashes))

# Download the samples using their hash values
for h in hashes:
    response = requests.post(
        "https://mb-api.abuse.ch/api/v1/",
        data={"query": "get_file", "sha256_hash": h}
    )
    with open(h, "wb") as f:
        f.write(response.content)

print("Download completed.")
